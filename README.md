# doctorant_test_bot
Telegram Bot 
Отлично! Включаем OpenAI и Whisper в стек технологий и формируем окончательное, полное ТЗ.

---

### **Полное Техническое Задание (ТЗ) для Telegram-бота "Докторантский Экзамен"**

**1. Общее назначение и функционал бота**
Telegram-бот предназначен для помощи абитуриентам в подготовке к докторантскому экзамену. Бот имитирует этапы экзамена, предоставляет обратную связь с использованием искусственного интеллекта и позволяет пользователям отслеживать свой прогресс.

**2. Структура экзамена**
[cite_start]Экзамен состоит из трех основных этапов/блоков[cite: 1]:
* [cite_start]**Собеседование**: 30 ұпай (баллов)[cite: 6].
* [cite_start]**Эссе**: 20 ұпай (баллов)[cite: 5].
* [cite_start]**Экзамен по профилю образовательной программы**: 50 ұпай (баллов)[cite: 3].
* [cite_start]**Общий максимальный балл**: 100 ұпай[cite: 2].
* [cite_start]**Проходной порог**: 75 ұпай[cite: 2].

**3. Тарифы и доступ**
[cite_start]Бот будет предлагать два тарифа[cite: 1]:
* **Полный доступ**: 10 000 тенге. [cite_start]Предоставляет доступ ко всем трем блокам экзамена[cite: 1].
* **Доступ по блокам**: 5 000 тенге за любой выбранный блок. [cite_start]Пользователь может приобрести доступ к одному конкретному блоку[cite: 1].

**4. Механизм оплаты и активации доступа**
* **Оплата**: Осуществляется через Каспи (Kaspi.kz).
* **Уведомление об оплате**: Пользователь в боте нажимает кнопку "Я оплатил" и/или отправляет скриншот платежа/номер транзакции.
* **Ручная проверка и активация**: Бот автоматически пересылает информацию о платеже в Telegram-чат менеджеров. Менеджер вручную проверяет оплату в системе Каспи и активирует соответствующий тариф пользователю в базе данных Superbase (предполагается админ-интерфейс или специальная команда для менеджеров).

**5. База данных (Superbase)**
Все данные будут храниться в Superbase.
* **Необходимые таблицы (предварительный список):**
    * `users`: `id` (Telegram ID), `first_name`, `last_name`, `university_id`, `specialty_id`, `subscription_type` (e.g., 'full', 'block_essay', 'block_exam', 'block_interview'), `subscription_status` (e.g., 'active', 'inactive'), `subscription_expires_at`.
    * `payments`: `id`, `user_id`, `amount`, `status` (e.g., 'pending', 'confirmed', 'rejected'), `payment_method`, `transaction_details`, `created_at`.
    * `universities`: `id`, `name`.
    * `specialties`: `id`, `university_id`, `name`.
    * `essay_topics`: `id`, `specialty_id`, `topic_text`.
    * `profile_exam_questions`: `id`, `specialty_id`, `question_text`, `question_type` (e.g., 'theory', 'practical', 'research'), `question_number_in_block`.
    * `interview_questions`: `id`, `question_text`, `question_order` (для последовательности).
    * `user_attempts`: `id`, `user_id`, `block_type`, `attempt_number`, `start_time`, `end_time`, `total_score`.
    * `user_answers`: `id`, `attempt_id`, `question_id`, `answer_text` (для эссе и профиля) / `audio_file_id` (для собеседования), `raw_ai_score`, `final_score`, `ai_feedback`, `submitted_at`, `is_final_submission` (для профиля).
    * `logs`: `id`, `user_id`, `action`, `timestamp`, `details`.
    * `statistics`: (агрегированные данные для аналитики, например, общее количество пользователей, активных подписок, пройденных экзаменов).
* **Доступ к Superbase**: Потребуются соответствующие API-ключи/конфигурации.

**6. Искусственный Интеллект (ИИ) - Технологии и функции**
* **ИИ-сервисы**: Будут использоваться **OpenAI (для текстовых моделей GPT)** и **Whisper (для распознавания речи)**.
* **API-ключи**: Потребуются API-ключи для OpenAI.
* **Функции ИИ:**
    * **Оценка эссе**: Анализ текста эссе с помощью OpenAI GPT по заданным критериям (см. ниже), выставление баллов и предоставление развернутого текстового фидбека.
    * **Обработка аудиосообщений (Собеседование)**: Преобразование аудио в текст с помощью **Whisper** (Speech-to-Text).
    * **Оценка собеседования**: Анализ распознанного текста с помощью OpenAI GPT по заданным критериям (см. ниже), выставление баллов и предоставление развернутого текстового фидбека.

**7. Взаимодействие с пользователем (Telegram-бот)**

**А. Начало работы и регистрация (`/start`)**
1.  Пользователь отправляет команду `/start`.
2.  Бот приветствует пользователя.
3.  Бот запрашивает **Имя и Фамилию** пользователя.
4.  Бот предлагает выбрать **Университет** из списка, подгружаемого из таблицы `universities` Superbase (используя inline-кнопки или список).
5.  После выбора Университета, бот предлагает выбрать **Специальность** из списка, соответствующего выбранному университету (из `specialties` Superbase).
6.  Все введенные данные (Telegram ID, Имя, Фамилия, Университет, Специальность) сохраняются в таблице `users` в Superbase.

**Б. Просмотр профиля и статистики (`/myprofile`)**
* По команде `/myprofile` бот выводит пользователю всю его личную информацию, используя Markdown для форматирования:
    * **Имя и Фамилия**.
    * Выбранные **Университет и Специальность**.
    * **Тип подписки** (например, "Полный доступ" или "Доступ по блокам: Эссе").
    * **Статус подписки** ("Активна" или "Неактивна").
    * **Срок окончания подписки**.
    * **Последние результаты и оценки** по каждому из доступных блоков:
        * **Экзамен по профилю**: Номер попытки, общие баллы, баллы по каждому вопросу, ИИ-фидбек.
        * **Эссе**: Номер попытки, тема эссе, количество слов, общие баллы, баллы по критериям, ИИ-фидбек.
        * **Собеседование**: Номер попытки, количество вопросов, общие баллы, баллы по критериям, ИИ-фидбек.
    * **Статистика использования**: Общее количество попыток в каждом блоке (сколько эссе написано, сколько собеседований пройдено, сколько экзаменов по профилю).
    * **История платежей**: Список последних платежей (дата, сумма, статус).

**8. Логика работы по блокам экзамена (с таймерами и напоминаниями)**

**Общие правила для таймеров:**
* Во всех блоках, где таймер установлен на весь этап (как в Экзамене по профилю и Эссе), бот отправляет **напоминание за 5 минут** до истечения времени.
* Во всех блоках, где таймер установлен на каждый ответ/вопрос (как в Собеседовании), бот отправляет **напоминание за 5 секунд** до истечения времени.
* По истечении времени, бот прекращает прием ответов для текущей задачи/вопроса и переходит к следующему этапу/вопросу или завершает блок.

**А. [cite_start]Блок "Экзамен по профилю образовательной программы" (50 баллов)** [cite: 3]
* [cite_start]**Структура билета**: 3 сұрақ (вопроса)[cite: 3].
    1.  [cite_start]Теориялық білім (Теоретические знания): 10 ұпай[cite: 4].
    2.  [cite_start]Практикалық-функционалдық білім (Практико-функциональные знания): 20 ұпай[cite: 4].
    3.  [cite_start]Зерттеу, әдіснама (Исследование, методология): 20 ұпай[cite: 4].
* **Таймер**: **Общий таймер на 90 минут** на все 3 вопроса.
    * [cite_start]Бот выдает **все 3 вопроса одновременно** одним сообщением при старте блока[cite: 3].
    * Сразу после выдачи вопросов запускается **общий таймер на 90 минут**.
    * Напоминание за **5 минут до истечения общего времени** на блок.
* **Взаимодействие**:
    * Бот выдает все 3 вопроса текстом сразу.
    * Пользователь может отвечать на вопросы как **одним сообщением**, так и **несколькими сообщениями**.
    * Для завершения ответов на все вопросы блока, пользователь отправляет **специальную команду** (например, `/done_exam` или `/finish_profile_exam`).
    * Если пользователь не отправил команду `/done_exam` до истечения 90 минут, бот автоматически завершает прием ответов и обрабатывает всё, что было прислано до этого момента.
* **Оценка**: После завершения блока (по команде или по таймеру), все собранные ответы отправляются на оценку OpenAI GPT по трем вышеуказанным критериям (Теоретические знания, Практико-функциональные знания, Исследование/Методология).

**Б. [cite_start]Блок "Эссе" (20 баллов)** [cite: 5]
* **Таймер**: **30 минут** на написание эссе.
    * Бот запускает таймер при выдаче темы.
    * За **5 минут до истечения времени**, бот отправляет напоминание.
    * По истечении 30 минут, бот прекращает прием эссе.
* **Тема**: Бот предоставляет **одну тему эссе**, выбранную из базы данных (Superbase) в соответствии с выбранной пользователем специальностью. [cite_start]Темы эссе связаны с университетом[cite: 5].
* [cite_start]**Типы эссе**: Мотивационное, Научно-аналитическое, Проблемно-тематическое[cite: 6].
* [cite_start]**Требования**: Эссе должно быть объемом **не менее 250 слов**[cite: 5].
* **Оценка**:
    * Бот проверяет количество слов. Если меньше 250, бот может уведомить пользователя или все равно отправить на оценку с соответствующим примечанием.
    * Текст эссе отправляется на оценку **OpenAI GPT**.
    * [cite_start]**Критерии оценки ИИ (каждый по 4 балла)**[cite: 6]:
        * Тақырыпты терең ашу (Глубокое раскрытие темы)
        * Өзіндік көзқарас (Собственная точка зрения)
        * Дәлелдердің жүйелілігі (Системность аргументов)
        * Құрылым мен логика (Структура и логика)
        * Академиялық жазу мәдениеті (Культура академического письма)
    * ИИ выставляет баллы по каждому критерию и предоставляет развернутый текстовый фидбек.

**В. [cite_start]Блок "Собеседование" (30 баллов)** [cite: 6]
* [cite_start]**Цель**: Отбор кандидатов, наиболее подготовленных к научно-исследовательской деятельности[cite: 7].
* [cite_start]**Задачи**: Определение склонности к исследовательской деятельности[cite: 7]; [cite_start]определение уровня научного потенциала и теоретической подготовки[cite: 8]; [cite_start]проверка уровня знаний по предложенной теме исследования[cite: 8]; [cite_start]проверка общей научной культуры и эрудиции[cite: 9].
* **Формат**: Бот задает вопросы **текстом**. Пользователь дает ответы **аудиосообщениями**.
* **Количество вопросов**: 7-8 вопросов.
* **Таймер**: На **каждый аудиоответ дается 1-1.5 минуты**.
    * Бот задает вопрос, запускает таймер.
    * Напоминание за **5 секунд до истечения времени** на каждый ответ.
    * Если пользователь не прислал аудиоответ в течение 1-1.5 минут, бот переходит к следующему вопросу.
* **Оценка**:
    * Аудиосообщения пользователя отправляются на **Whisper** для распознавания речи (Speech-to-Text).
    * Распознанный текст отправляется на оценку **OpenAI GPT**.
    * **Критерии оценки ИИ:**
        * [cite_start]Мотивация: 5 баллов [cite: 9] [cite_start](доказательство мотивов обучения в докторантуре по выбранной программе и поступления в конкретный университет; видение перспектив профессионального и личностного роста после завершения обучения [cite: 10]).
        * [cite_start]Зерттеу құзыреті (Исследовательская компетенция): 10 баллов [cite: 10] [cite_start](наличие исследовательских навыков и опыта, необходимых для научно-исследовательской деятельности в конкретной предметной области [cite: 10]).
        * [cite_start]Шығармашылық (Творчество): 10 баллов [cite: 11] [cite_start](нестандартное мышление, творческий и альтернативный подход к решению задач, ситуационных задач [cite: 11]).
        * [cite_start]Қарым-қатынас дағдылары (Коммуникативные навыки): 5 баллов [cite: 12] [cite_start](умение кратко, репрезентативно, логично и аргументированно излагать свою точку зрения, обобщать и делать выводы; знание языка [cite: 12]).
    * ИИ выставляет баллы по каждому критерию и предоставляет развернутый текстовый фидбек.

---

Это ТЗ является полным и окончательным. Оно включает все детали, которые мы обсуждали. Теперь мы готовы к следующему шагу – проектированию архитектуры системы и написанию кода.
